@model IEnumerable<DoAnThuVienNhom12.Models.Sach>

@{
    ViewBag.Title = "Quản lý sách";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-header">
    <h2><i class="fa fa-book"></i> Quản lý sách</h2>
</div>

<!-- 🔍 Thanh tìm kiếm -->
@using (Html.BeginForm("TimKiemSach", "Sach", FormMethod.Post, new { id = "searchForm" }))
{
    @Html.AntiForgeryToken()
    <div class="row" style="margin-bottom: 20px;">
        <div class="col-md-4">
            <input type="text" name="TuKhoa" class="form-control" placeholder="Tìm theo tên sách, tác giả, từ khóa..." />
        </div>

        <div class="col-md-3">
            <select name="TinhTrang" class="form-control">
                <option value="Tất cả">-- Tất cả tình trạng --</option>
                <option value="Còn hàng">Còn hàng</option>
                <option value="Hết hàng">Hết hàng</option>
            </select>
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-primary btn-block">
                <i class="fa fa-search"></i> Tìm kiếm
            </button>
        </div>

        <div class="col-md-3 text-right">
            <a href="@Url.Action("Create", "Sach")" class="btn btn-success">
                <i class="fa fa-plus"></i> Thêm sách mới
            </a>
        </div>
    </div>
}

<!-- 📚 Danh sách sách -->
<div id="bookListContainer">
    @Html.Partial("_BookList", Model)
</div>

<!-- ✅ Thông báo sau khi thêm / sửa / xóa -->
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade in" role="alert">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <strong>@TempData["Success"]</strong>
    </div>
}

@section Scripts {
    <script>
        // ============= AJAX tìm kiếm =============
        $('#searchForm').on('submit', function (e) {
            e.preventDefault();
            $.ajax({
                url: $(this).attr('action'),
                type: 'POST',
                data: $(this).serialize(),
                success: function (html) {
                    $('#bookListContainer').html(html);
                },
                error: function () {
                    alert('❌ Không thể tải danh sách sách. Vui lòng thử lại!');
                }
            });
        });

        // ============= Tự động ẩn thông báo sau 3 giây =============
        setTimeout(function () {
            $('.alert-success').fadeOut('slow');
        }, 3000);
    </script>
}

<style>
    h2 i {
        color: #3498db;
        margin-right: 8px;
    }

    #searchForm input,
    #searchForm select {
        border-radius: 6px;
    }

    .btn-success {
        background: linear-gradient(135deg, #28a745, #218838);
        border: none;
        color: #fff;
    }

        .btn-success:hover {
            background: linear-gradient(135deg, #218838, #28a745);
            color: white;
        }

    .alert-success {
        font-size: 16px;
        border-left: 5px solid #27ae60;
        background: #ecf9f1;
    }
</style>
